<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>用户列表</title>
    <meta charset="utf-8" />
    <script src="../JS/jquery-1.7.1.min.js"></script>
    <script src="../JS/jquery.easyui.min.js"></script>
    <script src="../JS/easyui-lang-zh_CN.js"></script>
    <link href="../CSS/pageStyle.css" rel="stylesheet" />
    <link href="../CSS/tableStyle.css" rel="stylesheet" />
    <link href="../CSS/themes/default/easyui.css" rel="stylesheet" />
    <link href="../CSS/themes/icon.css" rel="stylesheet" />
    <script type="text/javascript">
        $(function () {
            $("#addUserDiv").css("display", "none");
            $("#detailDiv").css("display", "none");
            loadUserInfo(1);
            $("#addUser").click(function () {
                bindAddUserClick();
            })
        })

        function loadUserInfo(pageIndex) {
            $.ajax({
                url: "UserList.ashx",
                type: "POST",
                data: { "pageIndex": pageIndex },
                datatype: "json",
                success: function (data) {
                    var serverData = $.parseJSON(data);
                    var length = serverData.UList.length;
                    for (var i = 0; i < length; i++) {
                        $("<tr><td>" + serverData.UList[i].ID + "</td><td>" + serverData.UList[i].UserName + "</td><td>" + serverData.UList[i].UserPass + "</td><td>" + serverData.UList[i].Email + "</td><td>" + bindChangeDateFormat(serverData.UList[i].RegTime) + "</td><td>Detail</td><td><a herf='javascript:void(0)' onclick = \"bindDelete('" + serverData.UList[i].UserName + "','" + serverData.UList[i].ID + "')\">Delete</a></td><td>Edit</td></tr>").appendTo("#tabList");
                    }
                    //将页码条绑定在Div上
                    $("#pagebar").html(serverData.MyPageBar);
                    bindMyPageBarClick();
                }
            })
        }

        //将序列化的Json时间格式转换
        function bindChangeDateFormat(cellVal) {
            var date = new Date(parseInt(cellVal.replace("/Date(", "").replace(")/", ""), 10));//parseInt(解析对象，解析进制)
            var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth + 1;
            var day = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
            return date.getFullYear() + "-" + month + "-" + day;
        }
        //绑定页码条点击事件
        function bindMyPageBarClick() {
            $(".myPageBar").click(function () {
                var pageIndex = $(this).attr("href").split("=")[1];
                $("#tabList tr:gt(0)").remove();
                $("#pagebar a").remove();
                loadUserInfo(pageIndex);
                return false;
            })
        }
        //删除用户数据
        function bindDelete(userName, id) {
            id = parseInt(id);
            //if (confirm("are you sure delete it:\u000d\u000d" + userName)) {
            //    $(location).attr('href', 'UserDelete.ashx?id=' + id)
            //}
            $.messager.confirm("pormpt", "are you sure delete it:\u000d\u000d" + userName, function (r) {
                if (r) {
                    $.ajax({
                        url: "UserDelete.ashx",
                        type: "POST",
                        data: { "id": id },
                        success: function (data) {
                            if (data == "ok") {
                                //清除表格中原有的数据
                                $("#tabList tr:gt(0)").remove();
                                //重新加载数据
                                loadUserInfo(1);
                                $.messager.show({
                                    title: "prompt",
                                    msg: "删除成功",
                                    showType: "show"
                                });
                            } else {
                                $.messager.alert("error", "删除失败", "error");
                            }
                        }
                    })
                }
            })
        }
        //添加用户数据
        function bindAddUserClick() {
            $("#addUserDiv").css("display", "block");
            $("#addUserDiv").dialog({
                width: 300,
                height: 300,
                title: "Add new user",
                collapsible: true,
                maximizable: true,
                resizable: true,
                modal: true,
                buttons: [{
                    text: 'ok',
                    iconcls: 'icon-ok',
                    handler: function () {
                        alert("ok");
                    }
                }, {
                    text: "Cancel",
                    handler: function () {
                        $("#addUserDiv").dialog("close");
                    }
                }]
            })
        }




    </script>
</head>
<body>
    <a href="javascript:void(0)" id="addUser">Add User Info</a>
    <table id="tabList">
        <tr><th>ID</th><th>UserNmae</th><th>UserPass</th><th>Email</th><th>RegTime</th><th>Detail</th><th>Delete</th><th>Edit</th></tr>
    </table>
    <div id="pagebar" class="page_nav"></div>
    <!-- 详细信息 -->
    <div id="detailDiv">
        <table>
            <tr><td>username</td><td><span id="userName"></span></td></tr>
            <tr><td>password</td><td><span id="userPass"></span></td></tr>
            <tr><td>email</td><td><span id="email"></span></td></tr>
            <tr><td>regtime</td><td><span id="regTime"></span></td></tr>
        </table>
    </div>
    <!-- 添加用户信息 -->
    <div id="addUserDiv">
        <table>
            <tr><th>Element</th><th>Information</th></tr>
            <tr><td>UserName：</td><td><input type="text" name="txtUserName" /></td></tr>
            <tr><td>UserPass:</td><td><input type="password" name="PassUserPass" /></td></tr>
            <tr><td>Email:</td><td><input type="text" name="txtEmail" /></td></tr>
            <tr><td colspan="2"><input type="submit" value="Create" /></td></tr>
        </table>
    </div>
</body>
</html>
